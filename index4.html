<!doctype>
<html>

<head>
    <script>
        window.$ = window.jQuery = require('./scripts/jquery-1.12.1.js');
    </script>
    <script src="Chart.js-master/Chart.js-master/Chart.js"></script>
</head>

<body>
<select id="category" onChange="createChar()"></select>
</body>
<script>
    var db;
      $(function(){
    console.log("doc ready");
    getMongoclient();          
});

function getMongoclient(){
        var MongoClient = require('mongodb').MongoClient;
        var url = 'mongodb://localhost:27017/mydb';
        MongoClient.connect(url, function(err, dbb){
            console.log("connected");
        db = dbb;
        getDistinctNames();
    }); 
}

function getDistinctNames(){
    console.log("creaDrop");
    var selc = document.getElementById("category");
    db.collection('alcoholdb').distinct("NAME",(function(err, doc){                  
       for(var i = 0; i < doc.length; i++){
        var op = document.createElement("option");
        if(doc[i]!=""){
            op.text = doc[i];
            selc.add(op);
        }
    }
    }));    
}


function createChar(){
    console.log("charCre")
     var selc = document.getElementById("category").value;
     var onePercent;
        db.collection('alcoholdb').aggregate([
            {$match:{"NAME":selc}},
            {$group:{_id:selc, Total:{$sum:"$TOTAL"}  }}
        ],function(err, result){
            onePercent = result[0].Total / 100;
        });
        
    db.collection('alcoholdb').aggregate([
        {$match:{"NAME":selc}},
        {$group:{_id:"$CATEGORY NAME", Sum:{$sum:"$TOTAL"}}},
        {$project:{Percent:{$divide: ["$Sum", 5]}}}
    ]).toArray(function(err, result){
        console.log(result);
    })
    
}
</script>

</html>